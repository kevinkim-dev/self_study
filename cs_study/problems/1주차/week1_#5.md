# OSI 7 Layer Reference Model(OSI 7 계층)을 설명해보아라

`OSI가 무엇인가?`

> Open Systems Interconnection Reference Model (이하 OSI)



- OSI 모형은 국제표준화기구(ISO)에서 개발한 모델로, 컴퓨터 네트워크 프로토콜 디자인과 통신을 계층으로 나누어 설명한 것이다.
- OSI 모형을 잘 이해하면 통신이 일어나는 과정을 단계별로 명확히 파악 할 수 있다.
- 7 계층이라는 이름처럼 통신이 일어나는 단계를 일곱가지 단계로 구분해놓았다.
- 일곱가지 단계는 순서대로 상하구조를 가진다. 즉 1 계층에서 7계층으로 와 같은 점프 식의 통신은 불가능하며, 계층을 순차적으로 거쳐야 통신이 가능하다는 뜻이다.

- 일곱 단계로 구분해 놓은 이유는 유지보수의 용의함을 위해서이다. 즉 한 계층에 문제가 생겨도 전체를 건드리지 않고 그 계층만 수정하면 문제 없이 통신을 할 수 있다.



`7계층이 무엇인가?`

> 7) Application Layer			   Application Layer
> 6) Presentation Layer			Presentation Layer
> 5) Session Layer				     Session Layer
> 4) Transport Layer				 Transport Layer
> 3) Network Layer			  	 Network Layer
> 2) Data Link Layer			 	 Data Link Layer
> 1) Physical Layer    <------->   Physical Layer



- OSI 7계층 모형은 Application Layer, Presentation Layer, Session Layer, Transport Layer, Network Layer, Data Link Layer, Physical Layer의 7개의 계층을 가지고 있다.
- 맨 아래 Physical Layer가 1계층이며, 위로 갈수록 계층이 하나씩 상승하고, Application Layer가 최상단의 7계층이다.
- 전송하고자 하는 데이터를 빠르고 신뢰성 있게 상대에게 보내기 위해서 Application Layer부터 Physical Layer로 내려갈 때 까지, 자신의 계층에서 수행한 작업 내용을 `Header`로 붙여 밑으로 내려보내는데, 이 것은 Encapsulation이라고 한다. (data가 점점 header안에 숨고 있다고 보면 된다.)
- 수신자가 데이터를 받으면 1계층에서 7계층으로 올라가면서 각각 계층에 Header를 제거하면서, Header 안의 데이터를 이용하여 적절히 수신하는데 이것을 Decapsulation이라고 한다. (Header에서 data를 추출하고 있다고 보면 된다.)
- 1, 2, 3, 4 계층을 묶어서 하위층, 5, 6, 7 계층을 묶어서 상위층이라고 부르기도 한다.
- A-P-S-T-N-D-P로 외우면 되는데, A Penguin Said That Nobody Drinks Pepsi라고 외우면 쉽다고 한다.



---



`천리 길도 한걸음부터라고... 7계층을 하나씩 뜯어보자`

> ...하



- 1계층 Physical Layer

  > "부릉 부릉..."  	- 택배 트럭

  - Physical Layer에서는 데이터를 상대방에게 보내는 방법만 고민한다. 즉 데이터의 내용과는 무관한 계층이다.
  - 장치간에 통신을 할 때 무엇이 필요한지 보면  무엇이 Physical Layer인지 알 수 있다
    - Internet 사용시엔 유선 인터넷 선을 컴퓨터에 꽂거나, 노트북 및 핸드폰에서는 와이파이를 사용한다.
    - 무선 이어폰과 핸드폰, 스피커와 마우스, 키보드 등을 컴퓨터와 연결할 때 블루투스를 사용한다.

  - 위의 예시처럼 유선이던 무선이던, 다른 장치와 통신할 수 있게 해주는 것을 Physical Layer라고 한다.

  - 모두가 알다시피 컴퓨터는 0과 1의 비트 연산으로 모든 작업을 수행한다. 이러한 0 과 1에 대한 정보를 전달할 수 있어야 Physical Layer가 된다.

    - 유선으로는 전기적 특성을 이용하여, 0과 1의 디지털 신호를 보낸다.

    - 무선으로는 전파적 특성을 이용하여, 0과 1의 디지털 신호를 보낸다.

  - Physical Layer의 보통 데이터 단위는 비트이다.



- 2계층 Data Link Layer

  > "이 물건은 의정부 택배 집하장으로 보내주시면 됩니다!"  	- 수원 택배 집하장 직원

  - Data Link Layer에서는 이 데이터가 어디로 가야할지를 생각한다. 중요한 점은 최종 목적지가 아닌 다음 목적지를 생각한다.

    > 엥? 그냥 보내고 싶은 장치에 바로 보내버리면 안되는거냐구~
    > 네 그게 안 됩니다...

  - 데이터가 최종 목적지까지 가기 위해서는 Switch와 Router를 거쳐야 한다.

  - Data Link Layer에서는 다음 Switch 혹은 Router로 가기 위한 작업을 수행한다.

  - Data Link Layer에서는 통신을 위해 MAC(Media Access Control)주소를 사용한다.

  - Data Link Layer에서는 흐름제어(Flow Control)과 에러제어(Error Control)을 수행한다

    - Flow Control: 송신자와 수신자의 처리 속도간의 차이를 해결하기 위한 제어를 한다.

      > 모두 SSAFY를 들어오기 위해 면접을 봤을 것이다.
      > 면접이 끝나고, 면접비를 받을 때의 상황을 생각해보면 된다.
      > 면접비를 주시는 분은 한분(수신의 속도는 정해져있음)인데, 10명씩 우르르 몰려가서 빨리 집에 가겠다고 면접비를 달라고 하면(송신자의 속도 과잉) 혼란스러워 차질이 생길 수 있다. 그렇기 때문에 다른 직원이 응시 번호 순서대로 한명씩 부르는 것(송신 속도 조절)이다.
      >
      > 이 것이 데이터의 흐름제어와 같은 부분이다.

    - Error Control: Physical Layer의 유선 혹은 무선 통신 과정에서 정보에 여러가지 요인으로 인해(외부 전기장 혹은 자기장) 손실 혹은 변화가 있을 수도 있다. 이 데이터의 에러를 감지하고 처리한다.
      에러를 발견하고 처리하는 방식에는 직접 에러를 수정하는 것과, 받은 데이터를 폐기하고 새로 보내달라고 요청을 하는 방식이 있다.

      > 공부를 하다 배가 고파진 김싸피는 배X의민족을 이용해서 피자를 주문했다.
      > 라이더의 오토바이(Physical Layer)를 뚫을 만한 추운 겨울이다보니 오는 길에 피자가 식어버렸다(데이터의 손실 혹은 변화).
      > 김싸피는 두가지 선택을 할 수 있다.
      >
      > 1. 피자를 그냥 전자레인지에 데워서 원래 따듯하던 상태로 먹는다.(직접 에러를 수정)
      > 2. 피자집에 전화해서 식었다고 항의하고 새 피자를 보내달라고 한다.(데이터 폐기후 재전송 요청)

  - Data Link Layer의 데이터 단위는 Frame이다. 



- 3계층 Network Layer

  > "이 택배는 수원 택배 집하장, 의정부 택배 집하장, 구리 우체국을 거쳐서 ㅇㅇ아파트로 xxx동 ㅁㅁㅁㅁ호로 가면 됩니다" 	- CJ 대한통운 직원

  - Network Layer에서는 최종 목적지를 생각한다.  즉 최종 목적지로 가기 위해서 어떤 노드(router, switch, modem 등)를 거쳐야 최적의 경로로 갈 수 있을 지 판단한다.

  - Network Layer에서는 MAC주소 대신 IP주소를 사용한다.

  - Network Layer에서는 포워딩(Forwarding)과 라우팅(Routing)을 수행한다.

    - Routing: 데이터의 출발지에서 목적지까지의 경로를 얻어내는 것

      >김싸피는 역삼에서 고터로 가기 위해 2호선을 타고 교대역에서 3호선으로 갈아타야 합니다.

    - Forwarding: 라우터의 입력 포트에서 출력 포트로 패킷을 이동시키는 것

      > 교대역(Router)에 도착해 2호선을 내린 김싸피(입력포트)는 Routing 정보 대로 3호선으로 갈아 타기 위해, 3호선 플렛폼(출력 포트)으로 이동합니다.

  - Network Layer의 데이터 단위는 Packet이다. 

  

---



`여기서 잠깐... MAC주소랑 IP주소는 뭘까?`

> IP Address 	vs 	MAC Address



- IP 주소는 어떠한 네트워크에 접속했을 때 부여받는 주소이다. (보통 변한다)

- MAC 주소는 데이터 통신이 가능한 어떠한 기기가 생성될 때 부여받는 주소이다. (보통 불변)

  > 김싸피가 태어나고 부여받은 주민등록번호(MAC 주소)는 웬만하면 변하지 않는다. 하지만 김싸피의 집 주소(IP 주소), 전화번호(IP 주소)는 김싸피가 이사갈 때마다, 전화번호를 바꿀 때 마다 바뀐다.
  >
  > 김싸피는 매일 집에서 SSAFY 수업을 듣고, 입실 체크와 퇴실 체크를 진행해왔다. ~~그러던 어느 날, 데이트 하던 중 여자친구가 "우리 집 가서 알고리즘 문제 풀다 갈래?"라는 말에 다음 날 출석도 버리고 여자친구 집에서 밤을 새웠다.~~ 다행히 자신의 분신과도 같은 노트북을 챙긴 김싸피는 할 수 없이 집이 아니지만 SSAFY 수업을 듣고, 입실 체크와 퇴실 체크도 진행 했으며, 건강 설문에 자택에서 수강했다고 적었다. 다음 날 담당 프로님이 건강 설문을 거짓으로 작성했냐며 전화를 걸었다. 담당 프로님은 어떻게 알았을까?
  >
  > 같은 노트북을 사용했으므로 MAC 주소는 같았다. 하지만, 자신의 집의 와이파이가 아닌 다른 집의 와이파이에 접속했으므로 IP주소는 달랐다. 과거까지 접속해왔던 김싸피의 IP주소와 이번에 접속한 IP주소가 다른데, 자택에서 수강했다고 했으므로 거짓말임이 들통 난 것이다!



---



- 4계층 Transport Layer

  >"고객님의 상품 배송이 시작되었습니다.", "고객님의 상품 배송이 완료되었습니다. 상품을 잘 받으셨나요?" 	- CJ 대한통운 직원

  - Data Link Layer와 Network Layer를 통해 마침내 다른 장치와의 통신이 시작되었다.

  - Transport Layer는 통신이 목적지에 제대로 도달했는지, Data가 제대로 전달 되고 있는지를 확인하는 작업을 수행한다.

  - 즉 양 끝단의 사용자들이 신뢰성있는 데이터를 주고 받게 해주는 역할을 한다.

  - 이러한 작업을 수행하기 위해 TCP 혹은 UDP를 사용한다.

    - TCP(Transmission Control Protocol): 신뢰성을 가지고 있지만 통신속도는 UDP보다 느리다. 통신을 시작할 때 3-way handshaking을 사용하고, 통신을 종료할 때 4-way handshaking을 사용하면서 신뢰성이 보장된다.

      - 3-way handshaking: Client와 Server가 통신을 시작하기 위해 확인을 거치는 과정

        > 수업 중에 화면 공유를 하고 본인의 코드를 설명하게 된 김싸피...

        1. Client가 Server에 접속을 요청하는 SYN 패킷을 보낸다.

           > 아아... 제 목소리 잘 들리시나요?(SYN)

        2. Server가 SYN을 잘 받았고 통신요청을 수락한다는 의미의 ACK(ACKnowledge)를 Client에게 보낸다.

           > 네~ 너무 잘 들립니다. 시작해주시면 됩니다.(ACK)

        3. Client가 ACK를 받았다는 의미에서 ACK를 Server에게 보내고, 연결이 되었다는 뜻의 Established 상태가 되며 데이터 통신을 시작한다. 

           > 아 네.. 그럼 시작하겠습니다.(ACK) 먼저 제 코드를 보시면...(데이터 통신 시작)

      - 4-way handshaking: Client와 Server가 통신을 끝내기 전에 확인을 거치는 과정

        > 본인의 코드 설명이 거의 끝난 김싸피...

        1. Client가 Server에 접속 종료를 요청하는 FIN 패킷을 보낸다.

           > ...이러이러 해서 답이 나오는 겁니다!(FIN)

        2. Server가 FIN을 잘 받았고 통신종료를 수락한다는 의미의 ACK(ACKnowledge)를 Client에게 보낸다. 이 때 아직 다 보내지 않은 Data가 있을 수 있으므로 Time_OUT이 된다.

           > 네~ 너무 잘들었습니다.(ACK)  김싸피 군의 이 쪽 코드를 보시면...(부연설명)(Time_OUT)

        3. Server가 통신을 종료해도 된다는 의미의 FIN 패킷을 client에게 보낸다.

           > 그럼 이제까지 설명하느라 고생해주신 김싸피님에게 박수 부탁드리고요, 화면 공유 종료해주시면 됩니다.(FIN)

        4. Client는 FIN을 받고 socket을 closed 상태로 변경한다.

           > 김싸피가 화면 공유를 종료한다.

    - UDP(User Datagram Protocol): 신뢰성이 없는 대신 빠른 속도를 가지고 있다. 주로 Real-time Process인 데이터 전송에 사용된다

      - Real-Time Process: 동영상 스트리밍, 전화 등 실시간으로 끊임없이 통신을 해야하는 작업을 말한다. 

        > 스트리밍으로 영상을 볼 때, 차라리 영상이 조금 깨지거나 화질이 낮아지는 것이 낫지, 영상 프레임이 다 오지 않았다고, 영상이 멈추거나 버퍼링이 계속 걸리면 더 짜증이 날 것이다.

  - Transport Layer의 데이터 단위는 Segment이다. 





- 5계층 Session Layer

  > "택배가 접수되었습니다." 	- 우체국 직원

  - 통신 기기간의 통신을 위해서는 세션(Session)이 생성되어야 하는데 이 작업을 수행하는 곳이다.

  - 네트워크 연결의 성립(Establishment), 제어와 운영(Manage and Control), 연결의 종료(Terminate)를 책임진다.

  - 송수신 방식을 관리하는 작업도 수행한다. 송수신의 방식에는 반 이중 방식(half-duplex), 전이중 방식(Full Duplex)가 있으며, 어떠한 방식을 사용할 지 결정하고 관리한다.

    - Half-duplex: 양 방향 통신이 가능하지만, 한번에 한쪽 방향으로만 통신이 가능함.

      > 무전기의 경우, 본인이 버튼을 누르고 있을 때만 음성신호가 전송된다. 즉 그 때는 다른 사람은 말을 할 수 없다는 소리이다

    - Full-duplex: 양 방향 통신이 항시 가능하다.

      > 전화의 경우, 동시에 두 사람이 모두 말해도 서로에게 서로의 목소리가 전달된다.

    - Simplex: 단 방향 통신(Session Layer의 고려 대상은 아님). 한 방향으로만 통신이 가능하다.

      > 마이크와 스피커의 경우 마이크로 들어온 음성이 스피커로 나올 수는 있지만, 스피커로 들어온 음성이 마이크로 나간다던지의 통신은 할 수 없다.

  - 에러복구에서도 한 몫을 하고 있다. 완벽히 전송된 정보까지 checkpoint를 삽입함으로써, 잘못 된 정보를 수신하여, 재 송신 요청을 받았을 때, 전부 다 처음부터 다시 보내지 않을 수 있도록 한다.

  - Session Layer의 데이터 단위는 Message이다. 

  



- 6계층 Presentation Layer

  > "택배를 보내시려면 상품 크기에 맞는 박스를 구매하시고, 접수장을 작성하시면 됩니다"  - 우체국 직원

  - Presentation Layer는 data의 형식(format)을 정의해서 원활한 네트워크 통신이 이루어지도록 한다.
  - 즉 통신자가 서로 다른 환경의 컴퓨터를 가졌더라도, 해당 data를 Application Layer에서 읽고 이해할 수 있도록 변환하는 계층이다.
  - 데이터의 압축(Compression), 암호화(Encryption), 데이터 포메팅(Data Formatting)을 수행한다.
    - Compression: 동영상, 음악 등 특히 용량이 큰 Multimedia file들의 원활한 전송을 위해 압축하는 작업을 말한다.
    - Encryption: 해킹, 즉 제 3자가 이 데이터를 수신하여 보는 것에 대비하여 목적지에 있는 Presentation Layer에서만 다시 Decryption(해독)할 수 있도록 암호화 하는 작업을 말한다.
    - Data Formatting: 통신하는 모든 장치들에서 호환이 되는 데이터의 형식을 설정하는 역할을 가지고 있다. 예시로 Unicord와 ASCII중에서 어떤 형식으로 텍스트를 나타낼 것인지를 들 수 있다.
  - Presentation Layer의 데이터 단위는 Data 이다. 



- 7계층 Application Layer

  > "남자친구에게 선물이랑 편지를 보내야지!"	- 김싸피 군의 여자친구 수웨아 양
  - Application Layer는 통신 때 전송할 data 내용이 생성되는 계층이다.
  - 사용자가 네트워크 자원에 접근하는 방법을 제공하며 사용자와 가장 가까운 계층이다.
  - 크롬, 이메일, 데이터베이스의 관리 등의 작업을 수행할 수 있다.
  - 인터넷 접속을 위한 HTTP 프로토콜, 메일 전송을 위한 SNTP, 파일 전송을 위한 FTP 프로토콜 규약에 따라 데이터가 생성된다.





```
PS. 변명같지만 TCP/IP 프로토콜에서 5~7계층을 통틀어서 Application Layer라고 부르기도 하는데 그 때문인지, 7계층의 Session Layer, Presentation Layer, Application Layer에 관련 된 세부적인 내용은 검색해도 많이 나오지 않아서 조금 아쉬웠다... 이 부분에 대해서 자세히 면접관이 물어본다면 지금까지의 지식으로는 솔직히 자세히는 모른다고 답변할 것 같다...
```

